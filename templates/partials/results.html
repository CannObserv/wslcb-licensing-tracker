<div class="mb-3 flex justify-between items-center">
    <p class="text-sm text-gray-600">
        <span class="font-semibold">{{ "{:,}".format(total) }}</span> record{{ 's' if total != 1 }} found
        {% if total > 0 %}
        — page {{ page }} of {{ total_pages }}
        {% endif %}
    </p>
</div>

{% if records %}
<div class="bg-white shadow-sm border border-gray-200 rounded-lg overflow-hidden">
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Business</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">License Type</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">App Type</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">License #</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for r in records %}
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location='/record/{{ r.id }}'">
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">{{ r.record_date }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm">
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium badge-{{ r.section_type.split('_')[0] }}">
                            {{ r.section_type | section_label }}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm font-medium text-gray-900 max-w-xs">
                        <div class="truncate">{{ r.business_name }}</div>
                        {% if r.previous_business_name and r.previous_business_name != r.business_name %}
                        <div class="text-xs text-gray-400 truncate" title="Previous: {{ r.previous_business_name }}">← {{ r.previous_business_name }}</div>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600 max-w-xs">
                        <div class="truncate">{{ r.display_city }}{% if r.display_zip %}, {{ r.display_zip }}{% endif %}</div>
                        {% if r.previous_business_location %}
                        <div class="text-xs text-gray-400 truncate" title="Previous: {{ r.previous_business_location }}">← {{ r.display_previous_city }}{% if r.display_previous_zip %}, {{ r.display_previous_zip }}{% endif %}</div>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600 max-w-xs">
                        {% if r.endorsements %}
                        <div class="flex flex-wrap gap-0.5 max-h-12 overflow-hidden relative">
                            {% for e in r.endorsements[:3] %}
                            <span class="inline-block bg-gray-100 text-gray-700 rounded px-1.5 py-0.5 text-xs">{{ e }}</span>
                            {% endfor %}
                            {% if r.endorsements | length > 3 %}
                            <span class="inline-block bg-gray-200 text-gray-500 rounded px-1.5 py-0.5 text-xs">+{{ r.endorsements | length - 3 }}</span>
                            {% endif %}
                        </div>
                        {% else %}
                        <span class="text-gray-400 text-xs">{{ r.license_type }}</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600">{{ r.application_type }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600 font-mono">{{ r.license_number }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% set pq = "q=" ~ (q|urlencode) ~ "&section_type=" ~ (section_type|urlencode) ~ "&application_type=" ~ (application_type|urlencode) ~ "&endorsement=" ~ (endorsement|urlencode) ~ "&city=" ~ (city|urlencode) ~ "&date_from=" ~ (date_from|urlencode) ~ "&date_to=" ~ (date_to|urlencode) %}

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="mt-4 flex justify-center gap-1">
    {% if page > 1 %}
    <a href="?{{ pq }}&page={{ page - 1 }}"
       class="px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50">← Prev</a>
    {% endif %}

    {% set start_page = [1, page - 3] | max %}
    {% set end_page = [total_pages, page + 3] | min %}

    {% if start_page > 1 %}
    <a href="?{{ pq }}&page=1"
       class="px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50">1</a>
    {% if start_page > 2 %}<span class="px-2 py-1.5 text-gray-400">…</span>{% endif %}
    {% endif %}

    {% for p in range(start_page, end_page + 1) %}
    <a href="?{{ pq }}&page={{ p }}"
       class="px-3 py-1.5 text-sm border rounded-md {{ 'bg-indigo-600 text-white border-indigo-600' if p == page else 'border-gray-300 hover:bg-gray-50' }}">
        {{ p }}
    </a>
    {% endfor %}

    {% if end_page < total_pages %}
    {% if end_page < total_pages - 1 %}<span class="px-2 py-1.5 text-gray-400">…</span>{% endif %}
    <a href="?{{ pq }}&page={{ total_pages }}"
       class="px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50">{{ total_pages }}</a>
    {% endif %}

    {% if page < total_pages %}
    <a href="?{{ pq }}&page={{ page + 1 }}"
       class="px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50">Next →</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="text-center py-12">
    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
    </svg>
    <h3 class="mt-2 text-sm font-medium text-gray-900">No records found</h3>
    <p class="mt-1 text-sm text-gray-500">Try adjusting your search or filters.</p>
</div>
{% endif %}
