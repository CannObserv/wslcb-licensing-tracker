<div class="mb-3 flex justify-between items-center">
    <p class="text-sm text-gray-600">
        <span class="font-semibold">{{ "{:,}".format(total) }}</span> record{{ 's' if total != 1 }} found
        {% if total > 0 %}
        — page {{ page }} of {{ total_pages }}
        {% endif %}
    </p>
    {% if total > 0 %}
    <a href="{{ export_url }}" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">⤓ Export CSV</a>
    {% endif %}
</div>

{% if records %}
{% include "partials/record_table.html" %}

{% set pq = "q=" ~ (q|urlencode) ~ "&section_type=" ~ (section_type|urlencode) ~ "&application_type=" ~ (application_type|urlencode) ~ "&endorsement=" ~ (endorsement|urlencode) ~ "&city=" ~ (city|urlencode) ~ "&date_from=" ~ (date_from|urlencode) ~ "&date_to=" ~ (date_to|urlencode) %}

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="mt-4 flex justify-center gap-1">
    {% if page > 1 %}
    <a href="?{{ pq }}&page={{ page - 1 }}" hx-get="/search?{{ pq }}&page={{ page - 1 }}"
       hx-target="#results" hx-push-url="true" hx-swap="innerHTML scroll:#results:top"
       class="px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50">← Prev</a>
    {% endif %}

    {% set start_page = [1, page - 3] | max %}
    {% set end_page = [total_pages, page + 3] | min %}

    {% if start_page > 1 %}
    <a href="?{{ pq }}&page=1" hx-get="/search?{{ pq }}&page=1"
       hx-target="#results" hx-push-url="true" hx-swap="innerHTML scroll:#results:top"
       class="px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50">1</a>
    {% if start_page > 2 %}<span class="px-2 py-1.5 text-gray-400">…</span>{% endif %}
    {% endif %}

    {% for p in range(start_page, end_page + 1) %}
    <a href="?{{ pq }}&page={{ p }}" hx-get="/search?{{ pq }}&page={{ p }}"
       hx-target="#results" hx-push-url="true" hx-swap="innerHTML scroll:#results:top"
       class="px-3 py-1.5 text-sm border rounded-md {{ 'bg-indigo-600 text-white border-indigo-600' if p == page else 'border-gray-300 hover:bg-gray-50' }}">
        {{ p }}
    </a>
    {% endfor %}

    {% if end_page < total_pages %}
    {% if end_page < total_pages - 1 %}<span class="px-2 py-1.5 text-gray-400">…</span>{% endif %}
    <a href="?{{ pq }}&page={{ total_pages }}" hx-get="/search?{{ pq }}&page={{ total_pages }}"
       hx-target="#results" hx-push-url="true" hx-swap="innerHTML scroll:#results:top"
       class="px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50">{{ total_pages }}</a>
    {% endif %}

    {% if page < total_pages %}
    <a href="?{{ pq }}&page={{ page + 1 }}" hx-get="/search?{{ pq }}&page={{ page + 1 }}"
       hx-target="#results" hx-push-url="true" hx-swap="innerHTML scroll:#results:top"
       class="px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50">Next →</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="text-center py-12">
    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
    </svg>
    <h3 class="mt-2 text-sm font-medium text-gray-900">No records found</h3>
    <p class="mt-1 text-sm text-gray-500">Try adjusting your search or filters.</p>
</div>
{% endif %}
