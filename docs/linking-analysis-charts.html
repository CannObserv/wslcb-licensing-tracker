<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Application ‚Üí Approval Linking Analysis</title>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f9fafb; color: #111827; }
  h1 { color: #6d4488; margin-bottom: 4px; }
  h2 { color: #374151; margin-top: 32px; }
  .subtitle { color: #6b7280; font-size: 14px; margin-bottom: 24px; }
  .chart-container { background: white; border-radius: 8px; padding: 20px; margin: 16px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
  .vega-embed { width: 100%; }
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin: 16px 0; }
  .stat-card { background: white; border-radius: 8px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center; }
  .stat-card .label { font-size: 13px; color: #6b7280; }
  .stat-card .value { font-size: 28px; font-weight: 700; margin-top: 4px; }
  .stat-card.green { border-left: 4px solid #22c55e; }
  .stat-card.amber { border-left: 4px solid #f59e0b; }
  .stat-card.gray { border-left: 4px solid #9ca3af; }
  .stat-card.red { border-left: 4px solid #ef4444; }
  .stat-card.purple { border-left: 4px solid #6d4488; }
  .note { font-size: 13px; color: #9ca3af; margin-top: 8px; font-style: italic; }
</style>
</head>
<body>

<h1>New Application ‚Üí Approval Linking Analysis</h1>
<p class="subtitle">WSLCB Licensing Tracker ‚Äî 42,092 new application records analyzed</p>

<h2>NEW APPLICATION Outcome Breakdown</h2>
<p class="note">Based on 6,887 records with application_type = 'NEW APPLICATION'</p>

<div class="stats-grid">
  <div class="stat-card green">
    <div class="label">‚úÖ Approved</div>
    <div class="value" style="color:#166534">3,164</div>
    <div class="label">46% ‚Äî high confidence match</div>
  </div>
  <div class="stat-card amber">
    <div class="label">‚è≥ Pending (Recent)</div>
    <div class="value" style="color:#92400e">1,753</div>
    <div class="label">25% ‚Äî filed after Feb 2025</div>
  </div>
  <div class="stat-card gray">
    <div class="label">‚ùì No Outcome Known</div>
    <div class="value" style="color:#374151">926</div>
    <div class="label">13% ‚Äî likely denied/withdrawn</div>
  </div>
  <div class="stat-card red">
    <div class="label">üö´ Discontinued</div>
    <div class="value" style="color:#991b1b">135</div>
    <div class="label">2% ‚Äî later discontinued</div>
  </div>
  <div class="stat-card purple">
    <div class="label">‚ö†Ô∏è Ambiguous Match</div>
    <div class="value" style="color:#6d4488">909</div>
    <div class="label">13% ‚Äî forward-only match</div>
  </div>
</div>

<h2>Time to Approval (Mutual Matches)</h2>
<div class="chart-container" id="time-chart"></div>

<h2>Match Rate by Application Type</h2>
<div class="chart-container" id="type-chart"></div>

<h2>All Application Types ‚Äî Bidirectional Matching</h2>
<div class="chart-container" id="stacked-chart"></div>

<script>
const timeData = [
  {bucket: "Same day", count: 9, order: 0},
  {bucket: "1‚Äì30 days", count: 731, order: 1},
  {bucket: "31‚Äì60 days", count: 1324, order: 2},
  {bucket: "61‚Äì90 days", count: 702, order: 3},
  {bucket: "91‚Äì180 days", count: 373, order: 4},
  {bucket: "181‚Äì365 days", count: 23, order: 5},
  {bucket: "365+ days", count: 2, order: 6}
];

vegaEmbed('#time-chart', {
  $schema: 'https://vega.github.io/schema/vega-lite/v5.json',
  width: 900,
  height: 300,
  autosize: { type: 'fit', contains: 'padding' },
  data: { values: timeData },
  mark: { type: 'bar', cornerRadiusTopLeft: 4, cornerRadiusTopRight: 4, color: '#6d4488' },
  encoding: {
    x: { field: 'bucket', type: 'nominal', sort: { field: 'order' }, title: 'Days from Application to Approval', axis: { labelAngle: 0 } },
    y: { field: 'count', type: 'quantitative', title: 'Number of Records' },
    tooltip: [{ field: 'bucket', title: 'Time Range' }, { field: 'count', title: 'Records' }]
  }
}, { actions: false, renderer: 'svg' });

const typeData = [
  { type: 'RENEWAL', total: 28677, matched: 23901, pct: 83.3 },
  { type: 'NEW APPLICATION', total: 6887, matched: 3164, pct: 45.9 },
  { type: 'ASSUMPTION', total: 2998, matched: 1779, pct: 59.3 },
  { type: 'CLASS/IN LIEU', total: 1059, matched: 395, pct: 37.3 },
  { type: 'CHANGE OF LOCATION', total: 681, matched: 85, pct: 12.5 },
  { type: 'CORP OFFICER', total: 233, matched: 62, pct: 26.6 },
  { type: 'RESUME BUSINESS', total: 28, matched: 16, pct: 57.1 }
];

vegaEmbed('#type-chart', {
  $schema: 'https://vega.github.io/schema/vega-lite/v5.json',
  width: 900,
  height: 280,
  autosize: { type: 'fit', contains: 'padding' },
  data: { values: typeData },
  mark: { type: 'bar', cornerRadiusTopLeft: 4, cornerRadiusTopRight: 4, color: '#6d4488' },
  encoding: {
    y: { field: 'type', type: 'nominal', sort: '-x', title: null },
    x: { field: 'pct', type: 'quantitative', title: 'High-Confidence Match Rate (%)', scale: { domain: [0, 100] } },
    tooltip: [
      { field: 'type', title: 'Application Type' },
      { field: 'matched', title: 'Mutual Matches', format: ',' },
      { field: 'total', title: 'Total New Apps', format: ',' },
      { field: 'pct', title: 'Match Rate', format: '.1f' }
    ]
  }
}, { actions: false, renderer: 'svg' });

const stackedData = [
  { type: 'RENEWAL', status: 'Mutual Match', count: 23901 },
  { type: 'RENEWAL', status: 'Ambiguous', count: 1666 },
  { type: 'RENEWAL', status: 'No Match', count: 3110 },
  { type: 'NEW APPLICATION', status: 'Mutual Match', count: 3164 },
  { type: 'NEW APPLICATION', status: 'Ambiguous', count: 909 },
  { type: 'NEW APPLICATION', status: 'No Match', count: 2814 },
  { type: 'ASSUMPTION', status: 'Mutual Match', count: 1779 },
  { type: 'ASSUMPTION', status: 'Ambiguous', count: 421 },
  { type: 'ASSUMPTION', status: 'No Match', count: 798 },
  { type: 'CLASS/IN LIEU', status: 'Mutual Match', count: 395 },
  { type: 'CLASS/IN LIEU', status: 'Ambiguous', count: 61 },
  { type: 'CLASS/IN LIEU', status: 'No Match', count: 603 },
  { type: 'CHANGE OF LOCATION', status: 'Mutual Match', count: 85 },
  { type: 'CHANGE OF LOCATION', status: 'Ambiguous', count: 43 },
  { type: 'CHANGE OF LOCATION', status: 'No Match', count: 553 },
  { type: 'CORP OFFICER', status: 'Mutual Match', count: 62 },
  { type: 'CORP OFFICER', status: 'Ambiguous', count: 35 },
  { type: 'CORP OFFICER', status: 'No Match', count: 136 }
];

vegaEmbed('#stacked-chart', {
  $schema: 'https://vega.github.io/schema/vega-lite/v5.json',
  width: 900,
  height: 280,
  autosize: { type: 'fit', contains: 'padding' },
  data: { values: stackedData },
  mark: { type: 'bar' },
  encoding: {
    y: { field: 'type', type: 'nominal', sort: { field: 'count', op: 'sum', order: 'descending' }, title: null },
    x: { field: 'count', type: 'quantitative', title: 'Number of Records', stack: 'normalize' },
    color: {
      field: 'status', type: 'nominal',
      scale: { domain: ['Mutual Match', 'Ambiguous', 'No Match'], range: ['#22c55e', '#f59e0b', '#d1d5db'] },
      title: 'Match Status'
    },
    tooltip: [
      { field: 'type', title: 'Application Type' },
      { field: 'status', title: 'Status' },
      { field: 'count', title: 'Records', format: ',' }
    ]
  }
}, { actions: false, renderer: 'svg' });
</script>

</body>
</html>
